{% extends "base.html" %}
{% block title %}내 티켓 · 남녕시네마{% endblock %}
{% block content %}
{% set movie = get_movie(t['movie_id']) %}
{% set ticket_type = t['type'] %}
{% set is_group   = (ticket_type == 'group') %}
{% set is_teacher = (ticket_type == 'teacher') %}
{% set is_normal  = (ticket_type == 'normal') %}

<section class="ticket-hero">
  <img src="{{ movie.poster or url_for('static', filename='images/poster-placeholder.jpg') }}"
       alt="{{ movie.title }}">
  </div>
</section>

<article class="ticket-sheet">
  {# 티켓 타입 스티커 #}
  {% if is_normal %}
    <div class="sticker">TICKET</div>
  {% elif is_group %}
    <div class="sticker gold">TICKET</div>
  {% else %}
    <div class="sticker prime">PRIME</div>
  {% endif %}

  <header class="sheet-head">
    <h2 class="sheet-title">{{ movie.title }}</h2>
    <span class="type-chip
      {% if is_normal %}type-red{% elif is_group %}type-gold{% else %}type-prime{% endif %}">
      {% if is_normal %}Red(일반){% elif is_group %}Gold(단체){% else %}Prime(교사){% endif %}
    </span>
  </header>

  <div class="kv" style="margin-top:12px">
    {# 예약자/호스트/교사 정보 #}
    {% if is_group %}
      <div class="item">
        <b>호스트</b>
        <span>{{ t['student_id'] }} {{ t['student_name'] }}</span>
      </div>
    {% elif is_normal %}
      <div class="item">
        <b>예약자</b>
        <span>{{ t['student_id'] }} {{ t['student_name'] }}</span>
      </div>
    {% elif is_teacher %}
      <div class="item">
        <b>담당 교사</b>
        <span>{{ t['teacher_name'] or '-' }} / {{ t['class_info'] or '' }}</span>
      </div>
    {% endif %}

    <div class="item">
      <b>상영날짜</b>
      <span>{{ t['date'] }}</span>
    </div>

    <div class="item">
      <b>예약번호</b>
      <span>{{ t['id'] }}</span>
    </div>

    <div class="item">
      <b>상영시간</b>
      <span>{{ t['time'] }}</span>
    </div>

    <div class="item">
      <b>상영관</b>
      <span>{{ t['hall'] }}</span>
    </div>

    {# 단체/교사용 추가 정보 #}
    {% if is_group %}
      <div class="item">
        <b>인원</b>
        <span>{{ t['group_size'] or 0 }}명</span>
      </div>

      {% if t['member_ids'] %}
      <div class="item">
        <b>동반자 학번</b>
        <span>{{ t['member_ids'] }}</span>
      </div>
      {% endif %}
    {% elif is_teacher %}
      {# 교사용은 위에서 이미 교사/과목을 보여줬으므로 추가 행은 생략 #}
    {% endif %}
  </div>

  <div class="divider"></div>

  <div class="meta-eyebrow" style="margin-bottom:8px">
    <span>Nyca 옵션</span>
    <span class="meta-line"></span>
  </div>

  <div class="t-actions">
    <button
      class="pill pill-soft"
      data-confirm
      data-title="예약 취소"
      data-message="정말 예약을 취소할까요? 취소 후 복구할 수 없습니다."
      data-endpoint="{{ url_for('ticket_delete', tid=t['id'], tab=t['type'], next='home') }}"
      data-method="POST">
      예약 취소
    </button>

    <a class="pill pill-soft"
       href="{{ url_for('movie_info', movie_id=t['movie_id']) }}"
       target="_blank" rel="noopener">
      영화 정보
    </a>

    <a class="pill pill-soft" href="{{ url_for('rules_doc', rtype=rtype) }}" target="_blank" rel="noopener">상영관 규정</a>
      
    </a>

    <a class="pill pill-soft" href="{{ url_for('index') }}">
      홈으로 돌아가기
    </a>
  </div>
</article>
{% endblock %}