{% extends "base.html" %}
{% block content %}
<section class="stack mt-24">
  <div class="stack mb-20">
    <p class="h-eyebrow">ğŸŸï¸ ê´€ë¦¬ í˜ì´ì§€</p>
    <h1 class="h-title-xxl">ì˜ˆë§¤ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
    <p class="text-muted">ì˜í™” ì˜ˆë§¤ ë‚´ì—­ì„ ê²€í† í•˜ê³  ìŠ¹ì¸, ê±°ì ˆ, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </div>

  <div class="stack mb-16" style="display:flex;gap:10px;flex-wrap:wrap">
   <a class="btn btn-primary" href="{{ url_for('admin_movies') }}">ğŸ¬ ì˜í™” ê´€ë¦¬</a>
   <a class="btn btn-primary" href="{{ url_for('admin_schedule') }}">ğŸ—“ ìŠ¤ì¼€ì¤„ ê´€ë¦¬</a>
  </div>

  <div class="card">
    <table class="table" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left; padding:10px;">ID</th>
          <th style="text-align:left; padding:10px;">ì˜í™”</th>
          <th style="text-align:left; padding:10px;">ì˜ˆì•½ì</th>
          <th style="text-align:left; padding:10px;">ë‚ ì§œ/ì‹œê°„/ê´€</th>
          <th style="text-align:left; padding:10px;">ìœ í˜•</th>
          <th style="text-align:left; padding:10px;">ìƒíƒœ</th>
          <th style="text-align:left; padding:10px;">ì‘ì—…</th>
        </tr>
      </thead>
      <tbody>
      {% for r in latest %}
        <tr style="border-top:1px solid var(--border);">
          <td style="padding:10px;">{{ r['id'] }}</td>
          <td style="padding:10px;">{{ r['movie_title'] }}</td>
          <td style="padding:10px;">{{ r['student_id'] }} {{ r['student_name'] }}</td>
          <td style="padding:10px;">{{ r['date'] }} {{ r['time'] }} / {{ r['hall'] }}</td>
          <td style="padding:10px;">{{ r['type'] }}</td>

          <td style="padding:10px;">
            {% if r['status'] == 'approved' %}
              <span class="badge bg-green-100 text-green-700">ìŠ¹ì¸ë¨</span>
            {% elif r['status'] == 'pending' %}
              <span class="badge bg-yellow-100 text-yellow-700">ëŒ€ê¸°</span>
            {% elif r['status'] == 'rejected' %}
              <span class="badge bg-red-100 text-red-700">ê±°ì ˆë¨</span>
            {% else %}
              <span class="badge">-</span>
            {% endif %}
          </td>

          <td style="padding:10px;">
            <button class="btn btn-secondary"
              data-confirm
              data-title="ìƒíƒœ ë³€ê²½"
              data-message="í•´ë‹¹ ì˜ˆì•½ì„ ìŠ¹ì¸ìœ¼ë¡œ ë˜ëŒë¦´ê¹Œìš”?"
              data-endpoint="{{ url_for('admin_set_status', tid=r['id']) }}"
              data-method="POST"
              data-body='{"status":"approved"}'>
              ìŠ¹ì¸
            </button>

            <button class="btn btn-light"
              data-confirm
              data-title="ìƒíƒœ ë³€ê²½"
              data-message="í•´ë‹¹ ì˜ˆì•½ì„ ëŒ€ê¸°ë¡œ ë˜ëŒë¦´ê¹Œìš”?"
              data-endpoint="{{ url_for('admin_set_status', tid=r['id']) }}"
              data-method="POST"
              data-body='{"status":"pending"}'>
              ëŒ€ê¸°
            </button>

            <button class="btn btn-outline-danger"
              data-confirm
              data-title="ìƒíƒœ ë³€ê²½"
              data-message="í•´ë‹¹ ì˜ˆì•½ì„ ê±°ì ˆë¡œ ë³€ê²½í• ê¹Œìš”?"
              data-endpoint="{{ url_for('admin_set_status', tid=r['id']) }}"
              data-method="POST"
              data-body='{"status":"rejected"}'>
              ê±°ì ˆ
            </button>

            <button class="btn btn-danger"
              data-confirm
              data-title="ì˜ˆì•½ ì‚­ì œ"
              data-message="ì •ë§ ì‚­ì œí• ê¹Œìš”? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
              data-endpoint="{{ url_for('admin_delete_ticket', tid=r['id']) }}"
              data-method="POST">
              ì‚­ì œ
            </button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
