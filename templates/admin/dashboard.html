{% extends "base.html" %}
{% block content %}
<section class="stack mt-24">
  <div class="stack mb-20">
    <p class="h-eyebrow">ğŸŸï¸ ê´€ë¦¬ í˜ì´ì§€</p>
    <h1 class="h-title-xxl">ì˜ˆë§¤ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
    <p class="text-muted">ì˜í™” ì˜ˆë§¤ ë‚´ì—­ì„ ê²€í† í•˜ê³  ìŠ¹ì¸/ëŒ€ê¸°/ê±°ì ˆ/ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </div>

  <div class="home-fold" style="display:flex;gap:10px;flex-wrap:wrap">
    <a class="btn btn-primary" href="{{ url_for('admin_movies') }}">ğŸ¬ ì˜í™” ê´€ë¦¬</a>
    <a class="btn btn-primary" href="{{ url_for('admin_schedule') }}">ğŸ—“ ìŠ¤ì¼€ì¤„ ê´€ë¦¬</a>
    <a class="btn btn-primary" href="{{ url_for('admin_rules_edit') }}">ğŸ“„ ê·œì • í¸ì§‘</a>
  </div>

  <div class="card">
    <table class="table" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left; padding:10px;">ì˜ˆì•½ë²ˆí˜¸</th>
          <th style="text-align:left; padding:10px;">ì˜í™”</th>
          <th style="text-align:left; padding:10px;">ì˜ˆì•½ì</th>
          <th style="text-align:left; padding:10px;">ë‚ ì§œ/ì‹œê°„/ê´€</th>
          <th style="text-align:left; padding:10px;">ìœ í˜•</th>
          <th style="text-align:left; padding:10px;">ìƒíƒœ</th>
          <th style="text-align:left; padding:10px;">ì‘ì—…</th>
        </tr>
      </thead>
      <tbody>
      {% for r in latest %}
        {% set type_label = 'Red(ì¼ë°˜)' if r['type']=='normal' else ('Gold(ë‹¨ì²´)' if r['type']=='group' else 'Prime(êµì‚¬)') %}
        <tr style="border-top:1px solid var(--border);">
          <td style="padding:10px;">{{ r['id'] }}</td>
          <td style="padding:10px;">{{ r['movie_title'] }}</td>
          <td style="padding:10px;">
            {% if r['type'] == 'teacher' %}
              {{ r['teacher_name'] or '-' }}<br><span class="text-muted">{{ r['class_info'] or '' }}</span>
            {% elif r['type'] == 'group' %}
              {{ r['student_id'] }} {{ r['student_name'] }}<br>
              {% if r['member_ids'] %}<span class="text-muted">ë™ë°˜ì: {{ r['member_ids'] }}</span>{% endif %}
            {% else %}
              {{ r['student_id'] }} {{ r['student_name'] }}
            {% endif %}
          </td>
          <td style="padding:10px;">{{ r['date'] }} {{ r['time'] }} / {{ r['hall'] }}</td>
          <td style="padding:10px;">{{ type_label }}</td>

          <td style="padding:10px;">
            {% if r['status'] == 'approved' %}
              <span class="badge bg-green-100 text-green-700">ìŠ¹ì¸ë¨</span>
            {% elif r['status'] == 'pending' %}
              <span class="badge bg-yellow-100 text-yellow-700">ëŒ€ê¸°</span>
            {% elif r['status'] == 'rejected' %}
              <span class="badge bg-red-100 text-red-700">ê±°ì ˆë¨</span>
            {% else %}
              <span class="badge">-</span>
            {% endif %}
          </td>

          <td style="padding:10px; display:flex; gap:6px; flex-wrap:wrap;">
            <button class="btn btn-primary"
              data-confirm
              data-title="ìƒíƒœ ë³€ê²½"
              data-message="í•´ë‹¹ ì˜ˆì•½ì„ ìŠ¹ì¸ìœ¼ë¡œ ë³€ê²½í• ê¹Œìš”?"
              data-endpoint="{{ url_for('admin_set_status', tid=r['id']) }}"
              data-method="POST"
              data-body='{"status":"approved"}'>
              ìŠ¹ì¸
            </button>

            <button class="btn btn-soft"
              data-confirm
              data-title="ìƒíƒœ ë³€ê²½"
              data-message="í•´ë‹¹ ì˜ˆì•½ì„ ëŒ€ê¸°ë¡œ ë³€ê²½í• ê¹Œìš”?"
              data-endpoint="{{ url_for('admin_set_status', tid=r['id']) }}"
              data-method="POST"
              data-body='{"status":"pending"}'>
              ëŒ€ê¸°
            </button>

            <button class="btn btn-soft"
              style="background:#fee2e2;color:#991b1b"
              data-confirm
              data-title="ìƒíƒœ ë³€ê²½"
              data-message="í•´ë‹¹ ì˜ˆì•½ì„ ê±°ì ˆë¡œ ë³€ê²½í• ê¹Œìš”?"
              data-endpoint="{{ url_for('admin_set_status', tid=r['id']) }}"
              data-method="POST"
              data-body='{"status":"rejected"}'>
              ê±°ì ˆ
            </button>

            <button class="btn btn-danger"
              data-confirm
              data-title="ì˜ˆì•½ ì‚­ì œ"
              data-message="ì •ë§ ì‚­ì œí• ê¹Œìš”? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
              data-endpoint="{{ url_for('admin_delete_ticket', tid=r['id']) }}"
              data-method="POST">
              ì‚­ì œ
            </button>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="7" style="padding:18px; text-align:center; color:#6b7280;">ìµœê·¼ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
